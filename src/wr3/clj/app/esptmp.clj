(ns wr3.clj.app.esptmp)

(def m1 '[
[1	一、安全目标35分	51]
[2	二、管理机构和人员35分	51]
[3	三、安全责任体系45分	51]
[4	四、法规和安全管理制度70分	51]
[5	五、安全投入45分	51]
[6	六、装备设施100分	51]
[7	七、安全技术管理110分	51]
[8	八、队伍建设90分	51]
[9	九、作业管理120分	51]
[10	十、危险源辩识与风险控制45分	51]
[11	十一、隐患排查与治理70分	51]
[12	十二、职业健康30分	51]
[13	十三、安全文化35分	51]
[14	十四、应急救援85分	51]
[15	十五、事故报告调查处理50分	51]
[16	十六、绩效考评与持续改进35分	51]
])

(def m2 '[
[1	1	安全工作方针与目标	51]
[1	2	中长期规划	51]
[1	3	年度计划	51]
[1	4	目标考核	51]
[2	1	安全管理机构	51]
[2	2	管理人员配备	51]
[3	1	健全责任制	51]
[3	2	责任制考评	51]
[4	1	资质	51]
[4	2	法规	51]
[4	3	安全管理制度	51]
[4	4	岗位安全生产操作规程	51]
[4	5	制度执行及档案管理	51]
[5	1	资金投入	51]
[5	2	费用管理	51]
[6	1	设施设备	51]
[6	2	设施安全管理	51]
[6	3	电气安全管理	51]
[7	1	施工组织设计	51]
[7	2	专项施工方案	51]
[7	3	安全技术交底	51]
[7	4	科技应用及创新	51]
[8	1	培训计划	51]
[8	2	宣传教育	51]
[8	3	管理人员	51]
[8	4	从业人员培训	51]
[8	5	规范档案	51]
[9	1	现场作业管理	51]
[9	2	安全值班	51]
[9	3	相关方管理	51]
[9	4	工作环境	51]
[9	5	警示标志	51]
[10	1	危险源辨识	51]
[10	2	风险控制	51]
[11	1	隐患排查	51]
[11	2	隐患治理	51]
[12	1	健康管理	51]
[12	2	工伤保险	51]
[12	3	危害告知	51]
[12	4	劳动保护	51]
[13	1	安全环境	51]
[13	2	安全行为	51]
[14	1	预案制定	51]
[14	2	预案实施	51]
[14	3	应急队伍	51]
[14	4	应急装备	51]
[14	5	应急演练	51]
[15	1	事故报告	51]
[15	2	事故处理	51]
[16	1	绩效评定	51]
[16	2	持续改进	51]
[16	3	安全管理体系建设	51]
])
 
(def m3 '[
[1	1	1	①制定企业安全生产方针、目标和不低于上级下达的安全控制指标；	3	5	51]
[1	1	2	②制定实现安全工作方针与目标的措施。	0	5	51]
[1	2	1	①制订和实施企业安全生产中长期规划和跨年度专项工作方案。	2	5	51]
[1	3	1	①根据中长期规划，制定年度计划和年度专项活动方案，并严格执行。	0	5	51]
[1	4	1	①将安全生产管理指标进行细化和分解，制定阶段性的安全生产控制指标；	0	5	51]
[1	4	2	②制定安全生产目标考核与奖惩办法；	0	5	51]
[1	4	3	③定期考核年度安全生产目标完成情况，并奖惩兑现。	0	5	51]
[2	1	1	①成立安全生产委员会（或领导小组），下属各分支机构分别成立相应的领导机构。安委会职责明确，实行主要领导负责制；	2	5	51]
[2	1	2	②按规定设置独立的安全生产管理机构；	3	10	51]
[2	1	3	③定期召开安全生产委员会会议。安全生产管理机构和下属各分支机构每月至少召开一次安全工作例会。	0	5	51]
[2	2	1	①按规定足额配备专职安全生产和应急管理人员；	3	10	51]
[2	2	2	②公司领导班子设置专职安全生产负责人。	2	5	51]
[3	1	1	①企业主要负责人、分管领导、全体员工安全职责明确，制定并落实安全生产责任制，层层签订安全生产责任书，并落实到位；	3	10	51]
[3	1	2	②主要负责人或实际控制人是安全生产第一责任人，按照安全生产法律法规赋予的职责，对安全生产负全面组织领导、管理责任和法律责任，并履行安全生产的责任和义务；	0	5	51]
[3	1	3	③分管安全生产的负责人是安全生产的重要负责人，统筹协调和综合管理企业的安全生产工作，对安全生产负重要管理责任；	0	5	51]
[3	1	4	④其他负责人和全体员工实行“一岗双责”，对业务范围内的安全生产工作负责；	0	5	51]
[3	1	5	⑤安全生产管理机构、各职能部门、生产基层单位的安全职责明确并落实到位。	0	10	51]
[3	2	1	①根据安全生产责任进行定期考核和奖惩，公告考评和奖惩情况。	2	10	51]
[4	1	1	①《企业法人营业执照》、《资质证书》等合法有效，经营范围符合要求。	3	10	51]
[4	2	1	①及时识别、获取适用的安全生产法律法规、标准规范；	0	5	51]
[4	2	2	②将法规标准和相关要求及时转化为本单位的规章制度，贯彻到各项工作中；	0	5	51]
[4	2	3	③将适用的安全生产法律、法规、标准及其他要求及时对从业人员进行宣传和培训。	0	5	51]
[4	3	1	①制定并及时修订安全生产管理制度，包括：1）安全生产责任制；2）安全例会制度；3）文件和档案管理制度；4）安全生产费用提取和使用管理制度；5）设施、设备、货物安全管理制度；6）安全生产培训和教育学习制度；7）安全生产监督检查制度；8）事故统计报告制度；9）安全生产奖惩制度；	0	10	51]
[4	3	2	②对从业人员进行安全管理制度的学习和培训。	0	5	51]
[4	4	1	①制定并及时修订各岗位的安全生产操作规程，并发放到岗位（职工）；	3	10	51]
[4	4	2	②对从业人员进行安全操作规程的学习和培训；从业人员严格执行本单位的安全操作规程。	0	5	51]
[4	5	1	①执行国家有关安全生产方针、政策、法规及本单位的安全管理制度和操作规程，依据行业特点，制定企业安全生产管理措施；	0	5	51]
[4	5	2	②每年至少一次对安全生产法律法规、标准规范、规章制度、操作规程的执行情况进行检查；	0	5	51]
[4	5	3	③建立和完善各类台帐和档案，并按要求及时报送有关资料和信息。	3	5	51]
[5	1	1	①按规定足额提取安全生产费用；	3	10	51]
[5	1	2	②安全生产经费专款专用，保证安全生产投入的有效实施；	2	10	51]
[5	1	3	③及时投入满足安全生产条件的所需资金。	0	10	51]
[5	2	1	①跟踪、监督安全生产专项经费使用情况；	0	10	51]
[5	2	2	②建立安全费用使用台账。	0	5	51]
[6	1	1	①具备满足安全生产需要的设施设备，并符合相关安全规范和技术要求；	0	10	51]
[6	1	2	②按有关规定配足有效的安全防护、环境保护、消防、救生设备及器材；	3	15	51]
[6	1	3	③按规定对设施设备进行定期检验，检验证书合法有效；	0	10	51]
[6	1	4	④按规定设置设施设备安全警告标志、指示牌。	0	5	51]
[6	2	1	①规范施工现场临时设施（包括临时建、构筑物、活动板房）的采购、租赁、搭设与拆除、验收、检查、使用的相关管理，有明确的安全制度，并严格落实；	0	10	51]
[6	2	2	②设施设备（包括作业船舶、车辆、特种设备等）符合相关安全规范和技术要求，设施设备及操作人员证书齐全有效；	0	10	51]
[6	2	3	③按规定定期对设备设施、电气线路、消防设施进行维护保养，特种设备定期进行检测检验，设备状态良好；	3	15	51]
[6	2	4	④指定专人对特种设备进行管理；	0	5	51]
[6	2	5	⑤建立并规范设备管理台账。	0	5	51]
[6	3	1	①按照国家相关法律法规规范电气安全管理。	0	10	51]
[7	1	1	①制定施工组织设计编制、审核、批准制度；	0	5	51]
[7	1	2	②施工组织设计中有明确的安全技术措施；	0	5	51]
[7	1	3	③按程序进行审核、批准；	0	5	51]
[7	1	4	④严格按照施工组织设计执行。	0	10	51]
[7	2	1	①制定危险性较大的分部、分项工程编写、审核、批准专项施工方案制度；	2	10	51]
[7	2	2	②按程序进行审核、批准；	0	5	51]
[7	2	3	③严格按照专项施工方案执行。	0	10	51]
[7	3	1	①制定安全技术交底规定；	0	5	51]
[7	3	2	②落实各级安全技术交底；	0	10	51]
[7	3	3	③交底有书面记录，履行签字手续。	0	5	51]
[7	4	1	①使用先进的、安全性能可靠的新技术、新工艺、新设备和新材料，优先选购安全、高效、节能的先进设备；	0	5	51]
[7	4	2	②设有安全生产管理系统或平台；	0	10	51]
[7	4	3	③取得ISO9001、ISO14001和OHSAS18000认证；	0	5	51]
[7	4	4	④组织开展安全生产科技攻关或课题研究；	0	10	51]
[7	4	5	⑤设有其他安全监管信息系统。	0	10	51]
[8	1	1	①制定并实施年度及长期的继续教育培训计划，明确培训内容和年度培训时间。	0	10	51]
[8	2	1	①组织开展安全生产的法律、法规和安全生产知识的宣传、教育。	0	10	51]
[8	3	1	①企业主要负责人和管理人员具备相应安全知识和管理能力，并取得行业主管部门培训合格证；	3	10	51]
[8	3	2	②专（兼）职安全管理人员具备专业安全生产管理知识和经验，熟悉各岗位的安全生产业务操作规程，运用专业知识和规章制度开展安全生产管理工作，并保持安全生产管理人员的相对稳定。	0	15	51]
[8	4	1	①从业人员每年接受再培训，提高从业人员的素质和能力，再培训时间不得少于有关规定学时。未经安全生产培训合格的从业人员，不得上岗作业；	2	10	51]
[8	4	2	②转岗人员及时进行岗前培训；	0	10	51]
[8	4	3	③新技术、新设备投入使用前，对管理和操作人员进行专项培训。	0	10	51]
[8	5	1	①建立健全安全宣传教育培训考评档案，详细、准确记录培训考评情况；	0	5	51]
[8	5	2	②对培训效果进行评审，改进提高培训质量。	0	10	51]
[9	1	1	①严格执行操作规程和安全生产作业规定，严禁违章指挥、违章操作、违反劳动纪律；	0	10	51]
[9	1	2	②在下达生产任务的同时，布置安全生产工作要求；	0	5	51]
[9	1	3	③从业人员具有相关资质条件；	3	10	51]
[9	1	4	④指定专人对危险作业进行现场管理；	0	10	51]
[9	1	5	⑤建立完善的安全检查制度，指定专人对危险作业进行现场管理，严格执行巡回检查制度，严禁无关人员进入作业区域。	2	10	51]
[9	1	6	⑥作业场所及设施设备应采用可靠的防雷、防风、防火和防电等措施；	0	10	51]
[9	1	7	⑦生产物资堆放和存储符合相关安全规范和技术要求；	0	5	51]
[9	2	1	①制定并落实安全生产值班计划和值班制度，重要时期实行领导到岗带班，有值班记录。	0	10	51]
[9	3	1	①两个或两个以上单位共用生产作业的现场安全生产管理职责明确，并落实到位；	0	5	51]
[9	3	2	②制定了协作单位（含供应商）管理制度，严格协作单位安全生产许可证、资质、资格审查，并严格执行严格执行开工前准备、过程监督、续用等管理；	0	10	51]
[9	3	3	③与协作单位签订安全协议，明确双方各自的安全责任；	0	5	51]
[9	3	4	④对短期合同工、临时用工、实习人员、外来参观人员、客户及其车辆等进入作业现场有相应的安全管理制度和措施；	0	5	51]
[9	3	5	⑤建立合格协作单位名录和安全生产档案。	0	5	51]
[9	4	1	①工作、生活场所的布置符合安全、消防和职业健康要求，疏散距离合理，消防通道畅通，各种设施布局合理。	0	10	51]
[9	5	1	①在存在危险因素的场所和设备设施，设置明显的安全警示标志，警示、告知危险种类、后果及应急措施，并严禁无关人员进入作业场所；	3	10	51]
[10	1	1	①开展本单位危险设施或场所危险源的辨识和确定工作；	0	10	51]
[10	1	2	②辩识重大危险源，采取有效防护措施，按规定报有关部门备案。	2	15	51]
[10	2	1	①及时对作业活动和设备设施进行危险、有害因素识别；	0	10	51]
[10	2	2	②向从业人员如实告知作业场所和工作岗位存在的危险因素、防范措施以及事故应急措施。	0	5	51]
[10	2	3	③对危险源进行建档，重大危险源单独建档管理。	0	5	51]
[11	1	1	①制定隐患排查工作方案，明确排查的目的、范围，选择合适的排查方法；	0	5	51]
[11	1	2	②每月至少开展一次安全自查自纠工作，及时发现安全管理缺陷和漏洞，消除安全隐患。检查及处理情况应当记录在案；	3	10	51]
[11	1	3	③对各种安全检查所查出的隐患进行原因分析，制定针对性控制对策。	0	10	51]
[11	2	1	①制定隐患治理方案，包括目标和任务、方法和措施、经费和物资、机构和人员、时限和要求；	0	10	51]
[11	2	2	②对上级检查指出或自我检查发现的一般安全隐患，严格落实防范和整改措施，并组织整改到位；	0	10	51]
[11	2	3	③重大安全隐患报相关部门备案，做到整改措施、责任、资金、时限和预案“五到位”；	2	10	51]
[11	2	4	④建立隐患治理台帐和档案，有相关的记录；	0	5	51]
[11	2	5	⑤按规定对隐患排查和治理情况进行统计分析，并向有关部门报送书面统计分析表。	0	10	51]
[12	1	1	①设置或指定职业健康管理机构，配备专（兼）职管理人员；	0	5	51]
[12	1	2	②按规定对员工进行职业健康检查。	0	5	51]
[12	2	1	①为从事危险作业人员办理意外伤害险。	2	5	51]
[12	3	1	①对从业人员进行职业健康宣传培训。使其了解其作业场所和工作岗位存在的危险因素和职业危害、防范措施和应急处理措施，降低或消除危害后果的事项。	0	5	51]
[12	4	1	①为从业人员提供符合职业健康要求的工作环境和条件，配备与职业健康保护相适应的设施、工具；	0	5	51]
[12	4	2	②对于会造成职业危害的岗位实行轮岗制度，或定期安排员工休假、疗养。	0	5	51]
[13	1	1	①设立安全文化廊、安全角、黑板报、宣传栏等员工安全文化阵地，每月至少更换两次内容；	0	5	51]
[13	2	2	②公开安全生产举报电话号码、通信地址或者电子邮件信箱。对接到的安全生产举报和投诉及时予以调查和处理。	2	5	51]
[13	2	1	①开展安全承诺活动；	1	5	51]
[13	2	2	②编制安全知识手册，并发放到职工；	0	5	51]
[13	2	3	③组织开展安全生产月活动、安全生产竞赛活动，有方案、有总结；	0	5	51]
[13	2	4	④对在安全工作中做出显著成绩的集体、个人给予表彰、奖励，并与其经济利益挂钩；	0	5	51]
[13	2	5	⑤对安全生产进行检查、评比、考评，总结和交流经验，推广安全生产先进管理方法。	0	5	51]
[14	1	1	①制定相应的突发事件应急预案，有相应的应急保障措施；	3	10	51]
[14	1	2	②结合实际将应急预案分为综合应急预案、专项应急预案和现场处置方案；	2	5	51]
[14	1	3	③应急预案与当地政府预案保持衔接，报当地有关部门备案，通报有关协作单位；	0	5	51]
[14	1	4	④定期评审应急预案，并根据评审结果或实际情况的变化进行修订和完善。	0	5	51]
[14	2	1	①开展应急预案的宣传教育，普及生产安全事故预防、避险、自救和互救知识；	0	5	51]
[14	2	2	②开展应急预案培训活动，使有关人员了解应急预案内容，熟悉应急职责、应急程序和应急处置方案；	3	5	51]
[14	2	3	③发生事故后，及时启动应急预案，组织有关力量进行救援，并按照规定将事故信息及应急预案启动情况报告有关部门。	0	10	51]
[14	3	1	①建立与本单位安全生产特点相适应的专兼职应急救援队伍，或指定专兼职应急救援人员；	0	5	51]
[14	3	2	②组织应急救援人员日常训练。	0	10	51]
[14	4	1	①按照应急预案的要求配备相应的应急物资及装备；	0	5	51]
[14	4	2	②建立应急装备使用状况档案，定期进行检测和维护，使其处于良好状态。	0	5	51]
[14	5	1	①按照有关规定制定应急预案演练计划，并按计划组织开展应急预案演练；	3	10	51]
[14	5	2	②应急预案演练结束后，对应急预案演练效果进行评审，撰写应急预案演练评审报告，分析存在的问题，并对应急预案提出修订意见。	1	5	51]
[15	1	1	①发生事故及时进行事故现场处置，按相关规定及时、准确、如实向有关部门报告，没有瞒报、谎报、迟报情况；	3	10	51]
[15	1	2	②跟踪事故发展情况，及时续报事故信息，建立事故档案和事故管理台帐。	0	5	51]
[15	2	1	①接到事故报告后，迅速采取有效措施，组织抢救，防止事故扩大，减少人员伤亡和财产损失；	0	10	51]
[15	2	2	②发生事故后，按规定成立事故调查组，积极配合各级人民政府组织的事故调查，随时接受事故调查组的询问，如实提供有关情况；	0	5	51]
[15	2	3	③按时提交事故调查报告，分析事故原因，落实整改措施；	0	5	51]
[15	2	4	④发生事故后，及时召开安全生产分析通报会，对事故当事人的聘用、培训、考评、上岗以及安全管理等情况进行责任倒查；	0	5	51]
[15	2	5	⑤按“四不放过”原则严肃查处事故，严肃查处安全生产事故，严格追究责任领导和相关责任人。处理结果报有关部门备案。	1	10	51]
[16	1	1	①每年至少一次对本单位安全生产标准化的实施情况进行评定，对安全生产工作目标、指标的完成情况进行综合考评。	0	5	51]
[16	2	1	①提出进一步完善安全标准化的计划和措施，对安全生产目标、指标、管理制度、操作规程等进行修改完善。	0	10	51]
[16	3	1	①根据企业生产经营实际，建立相应的安全管理体系，规范安全生产管理，形成长效机制。	1	20	51]
])

(require 'wr3.clj.datagen)
(use 'wr3.clj.n 'wr3.clj.s)
(use 'wr3.clj.app.espconf)

(defn- t1
  "造org表的数据字段" 
  []
  (with-mdb2 "esp"
    (let [rs (fetch :org) name3 (wr3.clj.datagen/rand-name) ]
      (doseq [r rs] (let [m {:_id ""
                             :name ""
                             :legalp (name3)
                             :admin 13
                             :mobile (format "13%s" (apply str (random-n 9 9))) }]
                      (update! :org r (dissoc (into m r) :legelp)) ))) ))

(defn- gen-pn-cid-
  "考评员证书号格式为：YYYY—C—NA—XXXXX。YYYY表示年份，C表示类别，NA表示发证机关, XXXXX表示编号"
  [type]
  (format "2011-%s-%s-%05d" type (-> (rand-nth (vec dd-admin)) first) (rand-int 100000)))

(defn- gen-org-cid-
  "考评员证书号格式为：YYYY—C—NA—甲XXXXX。YYYY表示年份，C表示类别，NA表示发证机关, XXXXX表示编号"
  [r]
  (let [nam (:name r)
        c (if (has? nam "港") "G" "D")
        grade (rand-nth ["乙" "丙"])
        admin (:admin r)
        admin (to-int admin)
        na (subs (dd-admin admin) 0 2)]
    (format "2012-%s-%s-%s%04d" c na grade (rand-int 10000))))
  
(use 'wr3.clj.nosql)
(use 'somnium.congomongo)

(defn- t1 []
(with-mdb2 "esp"
  (doseq [[i n t] m1]
    (insert! :indic1 {:i i :name (name n) :type2 t}))))

(defn- t2 []
(with-mdb2 "esp"
  (doseq [[i j n t] m2]
    (insert! :indic2 {:i i :j j :name (name n) :type2 t}))))

(defn- t3 []
(with-mdb2 "esp"
  (doseq [[i j k n star s t] m3]
    (insert! :indic3 {:i i :j j :k k :name (name n) :star star :score s :type2 t}))))

;(t3)
